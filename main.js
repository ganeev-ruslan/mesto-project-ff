(()=>{"use strict";var e={url:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"af6e5107-9f53-409b-89ed-6a4a2874b113","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}function n(n,r,o,c){var i=r.likes,u=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),a=u.querySelector(".card__image"),s=u.querySelector(".card__like-button"),l=u.querySelector(".like"),d=u.querySelector(".card__delete-button"),f=u.querySelector("button");return s.id=r._id,a.src=r.link,u.querySelector(".card__title").textContent=r.name,a.alt=r.name,u.id=r._id,i.forEach((function(e){e._id===n&&s.classList.add("card__like-button_is-active")})),r.owner._id!==n?f.remove():d.addEventListener("click",(function(){return o(u.id)})),s.addEventListener("click",(function(){return function(n,r,o){"card__like-button"===n.classList.value?function(n){return fetch("".concat(e.url,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return t(e)}))}(o).then((function(e){r.textContent=e.likes.length,n.classList.toggle("card__like-button_is-active")})).catch((function(e){console.error(e)})):function(n){return fetch("".concat(e.url,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))}(o).then((function(e){r.textContent=e.likes.length,n.classList.toggle("card__like-button_is-active")})).catch((function(e){console.error(e)}))}(s,l,r._id)})),l.textContent=r.likes.length,a.addEventListener("click",(function(){return c(r.link,r.name)})),u}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function o(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.submitFromInactive),t.classList.add(n.formSubmitActiv)):(t.disabled=!0,t.classList.add(n.submitFromInactive),t.classList.remove(n.formSubmitActiv))}function u(e,t){e.querySelectorAll("".concat(t.input,"-error")).forEach((function(e){e.textContent=""})),e.querySelectorAll(t.input).forEach((function(e){e.classList.remove(t.errorText)})),e.querySelector(t.submitButton).classList.add(t.submitFromInactive)}var a=document.querySelector(".profile__title"),s=document.querySelector(".profile__description"),l=document.querySelector(".places__list"),d=document.querySelector(".profile__image");document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("click",(function(e){e.currentTarget===e.target&&c(e.target)})),e.querySelector(".popup__close").addEventListener("click",(function(){return c(e)}))}));var f=document.forms["edit-profile"],m=document.querySelector(".popup_type_edit");document.querySelector(".profile__edit-button").addEventListener("click",(function(){f.name.value=a.textContent,f.description.value=s.textContent,u(m,v),r(m)})),f.addEventListener("submit",(function(n){var r,o;n.preventDefault(),q(!0,f),(r=f.name.value,o=f.description.value,fetch("".concat(e.url,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:"".concat(r),about:"".concat(o)})}).then((function(e){return t(e)}))).then((function(){a.textContent=f.name.value,s.textContent=f.description.value,c(m)})).finally((function(){q(!1,f)})).catch((function(e){console.error(e)}))}));var p=document.forms["new-place"],_=document.querySelector(".popup_type_new-card");document.querySelector(".profile__add-button").addEventListener("click",(function(){r(_)})),p.addEventListener("submit",(function(r){r.preventDefault();var o,i,a=p["place-name"].value,s=p.link.value;q(!0,p),(o=s,i=a,fetch("".concat(e.url,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:"".concat(i),link:"".concat(o)})}).then((function(e){return t(e)}))).then((function(e){var t=n(e.owner._id,e,y,h);l.prepend(t),p.reset(),u(_,v),c(_)})).finally((function(){q(!1,p)})).catch((function(e){console.error(e)}))}));var v={form:".popup__form",input:".popup__input",submitButton:".popup__button",submitFromInactive:"form__submit_inactive",formSubmitActiv:"form__submit_active",errorText:"popup__input-error_active"};function h(e,t){var n=document.querySelector(".popup_type_image "),o=n.querySelector(".popup__image"),c=n.querySelector(".popup__caption");o.src=e,c.textContent=t,r(n)}function y(n){var r;(r=n,fetch("".concat(e.url,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))).then((function(){document.getElementById("".concat(n)).remove()})).catch((function(e){console.error(e)}))}!function(e){Array.from(document.querySelectorAll(e.form)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.input)),r=e.querySelector(t.submitButton);i(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){t.classList.remove(n.errorText),e.querySelector(".".concat(t.id,"-error")).textContent=""}(e,t,n):function(e,t,n,r){t.classList.add(r.errorText),e.querySelector(".".concat(t.id,"-error")).textContent=n}(e,t,t.validationMessage,n)}(e,o,t),i(n,r,t)}))}))}(t,e)}))}(v),fetch("".concat(e.url,"/users/me"),{headers:e.headers}).then((function(e){return t(e)})).then((function(r){a.textContent=r.name,s.textContent=r.about,d.style='background-image: url("'.concat(r.avatar,'")');var o=r._id;fetch("".concat(e.url,"/cards"),{headers:e.headers}).then((function(e){return t(e)})).then((function(e){e.forEach((function(e){var t=n(o,e,y,h);l.append(t)}))})).catch((function(e){console.error(e)})).catch((function(e){console.error(e)}))}));var S=document.querySelector(".avatar_edit_popup");document.querySelector(".profile__image_button").addEventListener("click",(function(){r(S)}));var b=document.forms.avatar_edit;function q(e,t){t.querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"}b.addEventListener("submit",(function(n){n.preventDefault(),q(!0,b);var r=b.avatar.value;(function(n){return fetch("".concat(e.url,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return t(e)}))})(r).then((function(){d.style='background-image: url("'.concat(r,'")'),b.reset(),u(S,v),c(S)})).finally((function(){q(!1,b)})).catch((function(e){console.error(e)}))}))})();